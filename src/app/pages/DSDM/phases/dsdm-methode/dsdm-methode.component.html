<nb-card>
  <nb-card-body>
    <nb-stepper orientation="vertical">
      <nb-step label="PRE-PROJET">
        <div class="d-flex justify-content-between">
          <button nbButton disabled nbStepperNext>prev</button>
          <button nbButton nbStepperNext>next</button>
        </div>
        <div class="form-container" *ngIf="isEditMode || !dsdm">
          <form (ngSubmit)="isEditMode ? editDsdm() : addDsdm()" #dsdmForm="ngForm" class="dsdm-form">
            <h3>Objectif:</h3>
            <p class="description">
              L'objectif de cette phase est de bien prioriser le projet selon le contexte ; la priorisation se fera
              selon les autres projets en cours de réalisation et les objectifs business de l’entreprise.
            </p>
            <div class="form-group">
              <label for="context">Contexte</label>
              <span class="field-description">Décrivez le contexte du projet.</span>
              <input nbInput fullWidth id="context" class="form-control" [(ngModel)]="newDsdm.context" name="context"
                placeholder="Contexte du projet" required />
            </div>

            <div class="form-group">
              <label for="priorisation">Priorisation et objectif business</label>
              <span class="field-description">Décrivez la priorisation et les objectifs business du
                projet.</span>

              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newDsdm.priorisation"
                [ngModelOptions]="{ standalone: true }">
              </ckeditor>

              <!-- <textarea nbInput fullWidth id="priorisation" name="priorisation" class="form-control" [(ngModel)]="newDsdm.priorisation"
              placeholder="Priorisation et objectif business" required></textarea> -->
            </div>

            <div class="form-group">
              <label for="status">Statut</label>
              <span class="field-description">Sélectionnez le statut actuel du projet.</span>
              <select nbInput fullWidth id="status" class="form-control" [(ngModel)]="newDsdm.status" name="status"
                required>
                <option value="Approved">
                  Approved: Approuvé pour passer à la phase de faisabilité.
                </option>
                <option value="Planned">
                  Planned: Planifié mais n'a pas encore commencé.
                </option>
                <option value="On Hold">
                  On Hold: En attente en raison de contraintes.
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="startDate">Date de début</label>
              <span class="field-description">Sélectionnez la date de début du projet.</span>
              <input nbInput type="date" fullWidth id="startDate" [(ngModel)]="newDsdm.startDate" name="startDate"
                required />
            </div>

            <div class="form-group">
              <label for="endDate">Date de fin</label>
              <span class="field-description">Sélectionnez la date de fin estimée du projet.</span>
              <input nbInput type="date" fullWidth id="endDate" [(ngModel)]="newDsdm.endDate" name="endDate" />
            </div>

            <button nbButton status="primary" type="submit" [disabled]="!dsdmForm.valid">
              {{ isEditMode ? "Mettre à jour" : "Soumettre" }}
            </button>
            <button nbButton status="warning" (click)="cancelEdit()" *ngIf="isEditMode">
              Annuler
            </button>
          </form>
        </div>

        <div class="form-container" *ngIf="dsdm && !isEditMode">
          <nb-card-header>
            <h2>Phase de pré-projet</h2>
            <h6>Objectif:</h6>
            <p>
              L'objectif de cette phase est de bien prioriser le projet selon le contexte ;
              la priorisation se fera selon les autres projets en cours de réalisation et
              les objectifs business de l’entreprise.
            </p>
          </nb-card-header>
          <nb-card-body>
            <nb-accordion>
              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Contexte</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <p>{{ dsdm.context }}</p>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Priorisation et objectif business</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" (ready)="onReady($event)"
                    (change)="onChange($event)" (blur)="onBlur($event)" (focus)="onFocus($event)"
                    [(ngModel)]="dsdm.priorisation" [ngModelOptions]="{ standalone: true }">
                  </ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Statut</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <p [ngClass]="{
                      'status-approved': dsdm.status === 'Approved',
                      'status-planned': dsdm.status === 'Planned',
                      'status-on-hold': dsdm.status === 'On Hold'
                    }">
                    {{ dsdm.status }}
                  </p>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Date de début</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <p>{{ dsdm.startDate | date }}</p>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Date de fin</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <p>{{ dsdm.endDate | date }}</p>
                </nb-accordion-item-body>
              </nb-accordion-item>
            </nb-accordion>

            <div class="edit-button-container">
              <button nbButton status="info" (click)="enableEditMode()">
                <nb-icon icon="edit-outline"></nb-icon> Éditer
              </button>
            </div>
          </nb-card-body>
        </div>

      </nb-step>

      <nb-step label="FAISABILITY">
        <div class="d-flex justify-content-between">
          <button nbButton nbStepperPrevious>prev</button>
          <button nbButton nbStepperNext>next</button>
        </div>
        <div class="form-container" *ngIf="isEditModeFeasibility || !feasibility">
          <form (ngSubmit)="
              isEditModeFeasibility ? saveFeasibility() : addFeasibility()
            " #feasibilityForm="ngForm" class="feasibility-form">
            <h3>Objectif :</h3>
            <p class="description">
              Évaluer la faisabilité technique et commerciale du projet pour déterminer s'il est réalisable et
              bénéfique, assurant ainsi son succès futur et sa rentabilité. </p>

            <div class="form-group">
              <label for="technicalFeasibility">Analyse de Faisabilité Technique</label>
              <span class="field-description">Décrivez les technologies envisagées et leur viabilité.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFeasibility.technicalFeasibility"
                name="technicalFeasibility" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <div class="form-group">
              <label for="commercialFeasibility">Analyse de Faisabilité Commerciale</label>
              <span class="field-description">Analyse des coûts et des revenus potentiels.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFeasibility.commercialFeasibility"
                name="commercialFeasibility" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <div class="form-group">
              <label for="mvp">MVP</label>
              <span class="field-description">Décrivez les fonctionnalités essentielles du MVP.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFeasibility.mvp" name="mvp"
                [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <div class="form-group">
              <label for="releaseBoard">Release Board</label>
              <span class="field-description">Planification des versions avec des dates clés.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFeasibility.releaseBoard"
                name="releaseBoard" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <div class="form-group">
              <label for="viability">Viabilité du Projet</label>
              <span class="field-description">Justifiez les coûts par rapport aux besoins.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFeasibility.viability"
                name="viability" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <button nbButton status="primary" type="submit" [disabled]="!feasibilityForm.valid">
              {{ isEditModeFeasibility ? "Mettre à jour" : "Soumettre" }}
            </button>

            <button nbButton status="warning" (click)="cancelEdit()" *ngIf="isEditMode">
              Annuler
            </button>
            <button nbButton status="warning" (click)="cancelEditFeasibility()" *ngIf="isEditModeFeasibility">
              Annuler
            </button>
          </form>
        </div>
        <div class="form-container" *ngIf="feasibility && !isEditModeFeasibility">
          <nb-card-header>
            <h2>La phase de faisabilité</h2>
            <h6>Objectif:</h6>
            <p>Évaluer la faisabilité technique et commerciale du projet pour déterminer s'il est réalisable et
              bénéfique, assurant ainsi son succès futur et sa rentabilité.</p>
          </nb-card-header>
          <nb-card-body>
            <nb-accordion>
              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Analyse de Faisabilité Technique</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig"
                    [(ngModel)]="feasibility.technicalFeasibility" name="technicalFeasibility"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Analyse de Faisabilité Commerciale</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig"
                    [(ngModel)]="feasibility.commercialFeasibility" name="commercialFeasibility"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>MVP</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="feasibility.mvp" name="mvp">
                  </ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Release Board</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="feasibility.releaseBoard"
                    name="releaseBoard"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Viabilité du Projet</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="feasibility.viability"
                    name="viability"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>
            </nb-accordion>

            <button nbButton status="info" (click)="editFeasibility()">Éditer</button>
          </nb-card-body>
        </div>
      </nb-step>
      <nb-step label="FONDATIONS">
        <div class="d-flex justify-content-between">
          <button nbButton nbStepperPrevious>prev</button>
          <button nbButton nbStepperNext>next</button>
        </div>
        <div class="form-container" *ngIf="isEditModeFoundations || !foundations">
          <form (ngSubmit)="
              isEditModeFoundations ? saveFoundations() : addFoundations()
            " #foundationsForm="ngForm" class="foundations-form">
            <h3>Objectif :</h3>
            <p class="description">
              Construire une base solide pour le projet en définissant clairement les exigences, les ressources
              nécessaires, et les responsabilités, assurant ainsi une compréhension commune et durable.
            </p>

            <div class="form-group">
              <label for="projectVision">Vision du Projet</label>
              <span class="field-description">Décrivez la vision globale du projet et les objectifs
                principaux.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFoundations.projectVision"
                name="projectVision" [ngModelOptions]="{ standalone: true }"></ckeditor>
            </div>

            <div class="form-group">
              <label for="userNeeds">Besoins des Utilisateurs</label>
              <span class="field-description">Liste des besoins fonctionnels et non fonctionnels.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFoundations.userNeeds"
                name="userNeeds" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <div class="form-group">
              <label for="projectCharter">Documents de Fondation - Charte de Projet</label>
              <span class="field-description">Décrivez les objectifs, le scope, les parties prenantes et
                les critères de succès.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFoundations.projectCharter"
                name="projectCharter" [ngModelOptions]="{ standalone: true }"></ckeditor>
            </div>

            <div class="form-group">
              <label for="requirements">Documents de Fondation - Exigences Détaillées</label>
              <span class="field-description">Liste complète des fonctionnalités et exigences non
                fonctionnelles.</span>
              <ckeditor [editor]="editor" [config]="editorConfig" (ready)="onReady($event)" (change)="onChange($event)"
                (blur)="onBlur($event)" (focus)="onFocus($event)" [(ngModel)]="newFoundations.requirements"
                name="requirements" [ngModelOptions]="{ standalone: true }">
              </ckeditor>
            </div>

            <button nbButton status="primary" type="submit" [disabled]="!foundationsForm.valid">
              {{ isEditModeFoundations ? "Mettre à jour" : "Soumettre" }}
            </button>
            <button nbButton status="warning" (click)="cancelEdit()" *ngIf="isEditMode">
              Annuler
            </button>
            <button nbButton status="warning" (click)="cancelEditFoundations()" *ngIf="isEditModeFoundations">
              Annuler
            </button>
          </form>
        </div>

        <div class="form-container" *ngIf="foundations && !isEditModeFoundations">
          <nb-card-header>
            <h2>La phase de fondations</h2>
            <h6>Objectif:</h6>
            <p>Construire une base solide pour le projet en définissant clairement les exigences, les ressources
              nécessaires, et les responsabilités, assurant ainsi une compréhension commune et durable.</p>
          </nb-card-header>
          <nb-card-body>
            <nb-accordion>
              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Vision du Projet</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="foundations.projectVision"
                    name="projectVision"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Besoins des Utilisateurs</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="foundations.userNeeds"
                    name="userNeeds"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Charte de Projet</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="foundations.projectCharter"
                    name="projectCharter"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>

              <nb-accordion-item>
                <nb-accordion-item-header>
                  <h4>Exigences Détaillées</h4>
                </nb-accordion-item-header>
                <nb-accordion-item-body>
                  <ckeditor [editor]="editor" [config]="displayEditorConfig" [(ngModel)]="foundations.requirements"
                    name="requirements"></ckeditor>
                </nb-accordion-item-body>
              </nb-accordion-item>
            </nb-accordion>

            <div class="edit-button-container">
              <button nbButton status="info" (click)="editFoundations()">
                <nb-icon icon="edit-outline"></nb-icon> Éditer
              </button>
            </div>
          </nb-card-body>
        </div>
      </nb-step>
      <nb-step label="DEVELOPPEMENT">
        <nb-card>
          <nb-card-header>
            <div class="d-flex justify-content-between align-items-center">
              <button nbButton nbStepperPrevious>PREV</button>
              <h3 class="m-0">Gestion des Sprints et Itérations</h3>
              <button nbButton nbStepperNext>NEXT</button>
            </div>
          </nb-card-header>
          <nb-card-body>

            <button nbButton status="success" class="my-3" (click)="toggleSprintForm()">
              <nb-icon icon="plus-circle-outline"></nb-icon> Ajouter un Sprint
            </button>

            <!-- Formulaire d'ajout de sprint -->
            <div class="form-container" *ngIf="showSprintForm">
              <form (ngSubmit)="addSprint()" #sprintForm="ngForm" class="sprint-form">
                <h4>Ajouter un Sprint</h4>
                <div class="form-group">
                  <label for="sprintName">Nom du Sprint</label>
                  <input nbInput fullWidth id="sprintName" class="form-control" [(ngModel)]="newSprint.name"
                    name="sprintName" required />
                </div>
                <div class="d-flex justify-content-end">
                  <button nbButton status="primary" type="submit" [disabled]="!sprintForm.valid">
                    Ajouter
                  </button>
                  <button nbButton status="danger" type="button" (click)="toggleSprintForm()" class="ml-2">
                    Annuler
                  </button>
                </div>
              </form>
            </div>

            <!-- Liste des sprints -->
            <div class="form-container" *ngIf="sprints.length > 0">
              <nb-accordion>
                <nb-accordion-item *ngFor="let sprint of nonArchivedSprints">
                  <nb-accordion-item-header>
                    {{ sprint.name }}
                  </nb-accordion-item-header>
                  <nb-accordion-item-body>

                    <!-- Boutons d'action -->
                    <div class="d-flex justify-content-between">
                      <div *ngIf="!isEditModeSprint || editingSprint.id !== sprint.id">
                        <button nbButton status="info" (click)="toggleSprintEdit(sprint)">
                          <nb-icon icon="edit-outline"></nb-icon> Modifier
                        </button>
                        <button nbButton status="warning" (click)="archiveSprint(sprint)">
                          <nb-icon icon="archive-outline"></nb-icon> Archiver
                        </button>
                      </div>
                    </div>

                    <!-- Formulaire d'édition de sprint -->
                    <form *ngIf="isEditModeSprint && editingSprint.id === sprint.id" (ngSubmit)="saveSprint()">
                      <div class="form-group">
                        <label for="newSprintName">Nouveau nom</label>
                        <input nbInput fullWidth [(ngModel)]="editingSprintName" name="newSprintName" required placeholder="Nouveau nom">
                      </div>
                      <div class="d-flex justify-content-end">
                        <button nbButton status="success" type="submit">Mettre à jour</button>
                        <button nbButton status="warning" type="button" (click)="toggleSprintEdit(sprint)" class="ml-2">
                          Annuler
                        </button>
                      </div>
                    </form>

                    <!-- Ajouter une itération -->
                    <button nbButton status="primary" (click)="toggleIterationForm(sprint)" class="my-3">
                      <nb-icon icon="plus-circle-outline"></nb-icon> Ajouter une Itération
                    </button>

                    <form *ngIf="sprint.showIterationForm" (ngSubmit)="addIteration(sprint)" #iterationForm="ngForm"
                      class="iteration-form">
                      <h4>Ajouter une Itération à {{ sprint.name }}</h4>
                      <div class="form-group">
                        <label for="feature">Feature</label>
                        <input nbInput fullWidth id="feature" class="form-control" [(ngModel)]="newIteration.feature"
                          name="feature" required />
                      </div>
                      <div class="form-group">
                        <label for="deliverables">Deliverables</label>
                        <textarea nbInput fullWidth id="deliverables" name="deliverables" class="form-control"
                          [(ngModel)]="newIteration.deliverables" required></textarea>
                      </div>
                      <button nbButton status="primary" type="submit" [disabled]="!iterationForm.valid">
                        Ajouter Itération
                      </button>
                    </form>

                    <!-- Liste des itérations -->
                    <div class="iteration-list mt-4" *ngIf="sprint.iterations && sprint.iterations.length > 0">
                      <h5>Liste des Itérations</h5>
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Feature</th>
                            <th>Deliverables</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let iter of sprint.iterations" [hidden]="iter.archived">
                            <td *ngIf="!editingIteration || editingIteration.id !== iter.id">{{ iter.feature }}</td>
                            <td *ngIf="!editingIteration || editingIteration.id !== iter.id">{{ iter.deliverables }}</td>
                            <td *ngIf="editingIteration && editingIteration.id === iter.id">
                              <input nbInput fullWidth placeholder="Feature" [(ngModel)]="editingIteration.feature">
                            </td>
                            <td *ngIf="editingIteration && editingIteration.id === iter.id">
                              <input nbInput fullWidth placeholder="Deliverables"
                                [(ngModel)]="editingIteration.deliverables">
                            </td>
                            <td>
                              <div class="d-flex">
                                <button nbButton status="info" *ngIf="!editingIteration || editingIteration.id !== iter.id"
                                  (click)="editIteration(sprint, iter)">
                                  <nb-icon icon="edit-outline"></nb-icon>
                                </button>
                                <button nbButton status="warning"
                                  *ngIf="!editingIteration || editingIteration.id !== iter.id"
                                  (click)="archiveIteration(sprint, iter)">
                                  <nb-icon icon="archive-outline"></nb-icon>
                                </button>
                                <button nbButton status="success"
                                  *ngIf="editingIteration && editingIteration.id === iter.id"
                                  (click)="updateIteration(sprint)">
                                  <nb-icon icon="checkmark-outline"></nb-icon>
                                </button>
                                <button nbButton status="danger"
                                  *ngIf="editingIteration && editingIteration.id === iter.id"
                                  (click)="cancelEditIteration()">
                                  <nb-icon icon="close-outline"></nb-icon>
                                </button>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- Liste des itérations archivées -->
                    <div class="iteration-archive-list mt-4" *ngIf="sprint.iterations && sprint.iterations.length > 0">
                      <h5>Archives des Itérations</h5>
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Feature</th>
                            <th>Deliverables</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let iter of sprint.iterations" [hidden]="!iter.archived">
                            <td>{{ iter.feature }}</td>
                            <td>{{ iter.deliverables }}</td>
                            <td>
                              <button nbButton status="danger" (click)="deleteIteration(sprint, iter)">
                                <nb-icon icon="trash-2-outline"></nb-icon>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                  </nb-accordion-item-body>
                </nb-accordion-item>
              </nb-accordion>
            </div>

            <!-- Section des Sprints archivés -->
            <nb-card class="mt-5">
              <nb-card-header>
                <h4>Sprints Archivés</h4>
              </nb-card-header>
              <nb-card-body>
                <nb-accordion>
                  <nb-accordion-item *ngFor="let sprint of archivedSprints">
                    <nb-accordion-item-header>
                      {{ sprint.name }}
                    </nb-accordion-item-header>
                    <nb-accordion-item-body>
                      <button nbButton status="danger" (click)="deleteSprint(sprint)">
                        <nb-icon icon="trash-2-outline"></nb-icon> Supprimer
                      </button>
                      <!-- Ajoutez ici la gestion des itérations archivées si nécessaire -->
                    </nb-accordion-item-body>
                  </nb-accordion-item>
                </nb-accordion>
              </nb-card-body>
            </nb-card>

          </nb-card-body>
        </nb-card>
      </nb-step>


      <nb-step label="DEPLOIEMENT">
        <nb-card>
          <nb-card-header>
            <div class="d-flex justify-content-between align-items-center">
              <button nbButton nbStepperPrevious >PREV</button>
              <h3 class="m-0">Gestion des Plans de Déploiement</h3>
              <button nbButton nbStepperNext >NEXT</button>
            </div>
          </nb-card-header>
          <nb-card-body>

            <button nbButton status="success" class="my-3" (click)="toggleDeploymentPlanForm()">
              <nb-icon icon="plus-circle-outline"></nb-icon> Ajouter un Plan de Déploiement
            </button>

            <!-- Formulaire d'ajout de plan de déploiement -->
            <div class="form-container" *ngIf="showDeploymentPlanForm">
              <form (ngSubmit)="addDeploymentPlan()" #deploymentPlanForm="ngForm" class="deployment-form">
                <h4>Ajouter un Plan de Déploiement</h4>
                <div class="form-group">
                  <label for="environment">Environnement de Production</label>
                  <input nbInput fullWidth id="environment" class="form-control" [(ngModel)]="newDeploymentPlan.environment"
                    name="environment" required />
                </div>
                <div class="form-group">
                  <label for="dataMigration">Migration des Données</label>
                  <textarea nbInput fullWidth id="dataMigration" name="dataMigration" class="form-control"
                    [(ngModel)]="newDeploymentPlan.dataMigration" required></textarea>
                </div>
                <div class="form-group">
                  <label for="preProdTests">Tests de Pré-production</label>
                  <textarea nbInput fullWidth id="preProdTests" name="preProdTests" class="form-control"
                    [(ngModel)]="newDeploymentPlan.preProdTests" required></textarea>
                </div>
                <div class="d-flex justify-content-end">
                  <button nbButton status="primary" type="submit" [disabled]="!deploymentPlanForm.valid">
                    Ajouter Plan de Déploiement
                  </button>
                  <button nbButton status="danger" type="button" (click)="toggleDeploymentPlanForm()" class="ml-2">
                    Annuler
                  </button>
                </div>
              </form>
            </div>

            <!-- Liste des plans de déploiement -->
            <div class="form-container" *ngIf="deploymentPlans.length > 0">
              <nb-accordion>
                <nb-accordion-item *ngFor="let plan of nonArchivedDeploymentPlans">
                  <nb-accordion-item-header>
                    {{ plan.environment }}
                  </nb-accordion-item-header>
                  <nb-accordion-item-body>
                    <div class="plan-details">
                      <p><strong>Environnement :</strong> {{ plan.environment }}</p>
                      <p><strong>Migration des Données :</strong> {{ plan.dataMigration }}</p>
                      <p><strong>Tests de Pré-production :</strong> {{ plan.preProdTests }}</p>
                    </div>
                    <!-- Boutons d'action pour le plan de déploiement -->
                    <div class="d-flex justify-content-between">
                      <div *ngIf="!isEditModeDeploymentPlan || editingDeploymentPlan.id !== plan.id">
                        <button nbButton status="info" (click)="toggleDeploymentPlanEdit(plan)">
                          <nb-icon icon="edit-outline"></nb-icon> Modifier
                        </button>
                        <button nbButton status="warning" (click)="archiveDeploymentPlan(plan)">
                          <nb-icon icon="archive-outline"></nb-icon> Archiver
                        </button>
                      </div>
                    </div>

                    <!-- Formulaire d'édition de plan de déploiement -->
                    <form *ngIf="isEditModeDeploymentPlan && editingDeploymentPlan.id === plan.id" (ngSubmit)="saveDeploymentPlan()">
                      <div class="form-group">
                        <label for="newEnvironment">Nouvel Environnement</label>
                        <input nbInput fullWidth [(ngModel)]="editingDeploymentPlan.environment" name="newEnvironment" required placeholder="Nouvel Environnement">
                      </div>
                      <div class="form-group">
                        <label for="newDataMigration">Nouvelle Migration des Données</label>
                        <textarea nbInput fullWidth [(ngModel)]="editingDeploymentPlan.dataMigration" name="newDataMigration" required></textarea>
                      </div>
                      <div class="form-group">
                        <label for="newPreProdTests">Nouveaux Tests de Pré-production</label>
                        <textarea nbInput fullWidth [(ngModel)]="editingDeploymentPlan.preProdTests" name="newPreProdTests" required></textarea>
                      </div>
                      <div class="d-flex justify-content-end">
                        <button nbButton status="success" type="submit">Mettre à jour</button>
                        <button nbButton status="warning" type="button" (click)="toggleDeploymentPlanEdit(plan)" class="ml-2">
                          Annuler
                        </button>
                      </div>
                    </form>

                    <!-- Bouton pour ajouter une release -->
                    <button nbButton status="primary" (click)="toggleReleaseForm(plan)" class="my-3">
                      <nb-icon icon="plus-circle-outline"></nb-icon> Ajouter une Release
                    </button>

                    <!-- Formulaire d'ajout de release -->
                    <form *ngIf="plan.showReleaseForm" (ngSubmit)="addRelease(plan)" #releaseForm="ngForm"
                      class="release-form">
                      <h4>Ajouter une Release pour {{ plan.environment }}</h4>
                      <div class="form-group">
                        <label for="releaseName">Nom de la Release</label>
                        <input nbInput fullWidth id="releaseName" class="form-control" [(ngModel)]="newRelease.name"
                          name="releaseName" required />
                      </div>
                      <div class="form-group">
                        <label for="releaseDetails">Détails de la Release</label>
                        <textarea nbInput fullWidth id="releaseDetails" name="releaseDetails" class="form-control"
                          [(ngModel)]="newRelease.details" required></textarea>
                      </div>
                      <div class="d-flex justify-content-end">
                        <button nbButton status="primary" type="submit" [disabled]="!releaseForm.valid">
                          Ajouter Release
                        </button>
                      </div>
                    </form>

                   <!-- Liste des releases -->
<div class="release-list mt-4" *ngIf="plan && plan.releases && plan.releases.length > 0">
  <h5>Liste des Releases</h5>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Détails</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let release of plan.releases" [hidden]="release.archived">
        <td *ngIf="!isEditModeRelease || (editingRelease && editingRelease.id !== release.id)">
          {{ release.name }}
        </td>
        <td *ngIf="!isEditModeRelease || (editingRelease && editingRelease.id !== release.id)">
          {{ release.details }}
        </td>
        <td *ngIf="isEditModeRelease && editingRelease && editingRelease.id === release.id">
          <input nbInput fullWidth [(ngModel)]="editingRelease.name" placeholder="Nom">
        </td>
        <td *ngIf="isEditModeRelease && editingRelease && editingRelease.id === release.id">
          <textarea nbInput fullWidth [(ngModel)]="editingRelease.details" placeholder="Détails"></textarea>
        </td>
        <td>
          <div class="d-flex">
            <button nbButton status="info" *ngIf="!isEditModeRelease || (editingRelease && editingRelease.id !== release.id)"
              (click)="editRelease(plan, release)">
              <nb-icon icon="edit-outline"></nb-icon>
            </button>
            <button nbButton status="warning" *ngIf="!isEditModeRelease || (editingRelease && editingRelease.id !== release.id)"
              (click)="archiveRelease(plan, release)">
              <nb-icon icon="archive-outline"></nb-icon>
            </button>
            <button nbButton status="success" *ngIf="isEditModeRelease && editingRelease && editingRelease.id === release.id"
              (click)="updateRelease(plan)">
              <nb-icon icon="checkmark-outline"></nb-icon>
            </button>
            <button nbButton status="danger" *ngIf="isEditModeRelease && editingRelease && editingRelease.id === release.id"
              (click)="cancelEditRelease()">
              <nb-icon icon="close-outline"></nb-icon>
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

                    <!-- Liste des releases archivées -->
                    <div class="release-archive-list mt-4" *ngIf="plan.releases && plan.releases.length > 0">
                      <h5>Archives des Releases</h5>
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Nom</th>
                            <th>Détails</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let release of plan.releases" [hidden]="!release.archived">
                            <td>{{ release.name }}</td>
                            <td>{{ release.details }}</td>
                            <td>
                              <button nbButton status="danger" (click)="deleteRelease(plan, release)">
                                <nb-icon icon="trash-2-outline"></nb-icon>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                  </nb-accordion-item-body>
                </nb-accordion-item>
              </nb-accordion>
            </div>

            <!-- Liste des plans archivés -->
            <div class="form-container" *ngIf="archivedDeploymentPlans.length > 0">
              <nb-card-header>
                <h2>Plans de Déploiement Archivés</h2>
              </nb-card-header>
              <nb-card-body>
                <nb-accordion>
                  <nb-accordion-item *ngFor="let plan of archivedDeploymentPlans">
                    <nb-accordion-item-header>
                      {{ plan.environment }}
                    </nb-accordion-item-header>
                    <nb-accordion-item-body>
                      <div class="plan-details">
                        <p>
                          <strong>Migration des Données:</strong>
                          {{ plan.dataMigration }}
                        </p>
                        <p>
                          <strong>Tests de Pré-production:</strong>
                          {{ plan.preProdTests }}
                        </p>
                      </div>
                      <button nbButton status="danger" (click)="deleteDeploymentPlan(plan)">
                        <nb-icon icon="trash-2-outline"></nb-icon> Supprimer Définitivement
                      </button>
                    </nb-accordion-item-body>
                  </nb-accordion-item>
                </nb-accordion>
              </nb-card-body>
            </div>

          </nb-card-body>
        </nb-card>
      </nb-step>

      <nb-step label="POST-PROJET">
        <div class="d-flex justify-content-between navigation-buttons">
          <button nbButton nbStepperPrevious>prev</button>
          <button nbButton disabled nbStepperNext>next</button>
        </div>
        <nb-card>
          <nb-card-header>
            <h2>Phase de Post-projet</h2>
            <p>
              Objectif : Mesurer les performances business du produit et
              s'assurer qu'il atteint les résultats attendus.
            </p>
          </nb-card-header>
          <nb-card-body>
            <!-- Évaluation des Performances -->
            <nb-tabset fullWidth>
              <!-- Indicateurs Clés de Performance (KPI) -->
              <nb-tab tabTitle="Évaluation des Performances">
                <form (ngSubmit)="addKpi()" #kpiForm="ngForm" class="kpi-form">
                  <h4>Indicateurs Clés de Performance (KPI)</h4>
                  <div class="form-group">
                    <label for="kpiName">Nom du KPI</label>
                    <input
                      nbInput
                      fullWidth
                      id="kpiName"
                      class="form-control"
                      [(ngModel)]="newKpi.name"
                      name="kpiName"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="kpiValue">Valeur du KPI</label>
                    <input
                      nbInput
                      fullWidth
                      id="kpiValue"
                      class="form-control"
                      [(ngModel)]="newKpi.value"
                      name="kpiValue"
                      required
                    />
                  </div>
                  <button nbButton status="primary" type="submit" [disabled]="!kpiForm.valid">
                    Ajouter KPI
                  </button>
                </form>

                <div *ngIf="kpis.length">
                  <h4>Liste des KPI</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Nom</th>
                        <th>Valeur</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let kpi of kpis">
                        <td>{{ kpi.name }}</td>
                        <td>{{ kpi.value }}</td>
                        <td>
                          <button nbButton status="info" (click)="editKpi(kpi)">
                            <nb-icon icon="edit-outline"></nb-icon>
                          </button>
                          <button nbButton status="warning" (click)="archiveKpi(kpi)">
                            <nb-icon icon="archive-outline"></nb-icon>
                          </button>
                          <button nbButton status="danger" [disabled]="!kpi.archived" (click)="deleteKpi(kpi)">
                            <nb-icon icon="trash-2-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div *ngIf="archivedKpis.length">
                  <h4>KPI Archivés</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Nom</th>
                        <th>Valeur</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let kpi of archivedKpis">
                        <td>{{ kpi.name }}</td>
                        <td>{{ kpi.value }}</td>
                        <td>
                          <button nbButton status="danger" (click)="deleteKpi(kpi)">
                            <nb-icon icon="trash-2-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </nb-tab>

              <!-- Rapports de Performance -->
              <nb-tab tabTitle="Rapports de Performance">
                <form (ngSubmit)="addReport()" #reportForm="ngForm" class="report-form">
                  <h4>Rapports de Performance</h4>
                  <div class="form-group">
                    <label for="reportTitle">Titre du Rapport</label>
                    <input nbInput fullWidth id="reportTitle" class="form-control" [(ngModel)]="newReport.title"
                      name="reportTitle" required />
                  </div>
                  <div class="form-group">
                    <label for="reportContent">Contenu du Rapport</label>
                    <textarea nbInput fullWidth id="reportContent" class="form-control" [(ngModel)]="newReport.content"
                      name="reportContent" required></textarea>
                  </div>
                  <button nbButton status="primary" type="submit" [disabled]="!reportForm.valid">
                    Ajouter Rapport
                  </button>
                </form>

                <div *ngIf="reports.length">
                  <h4>Liste des Rapports</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Titre</th>
                        <th>Contenu</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let report of reports">
                        <td>{{ report.title }}</td>
                        <td>{{ report.content }}</td>
                        <td>
                          <button nbButton status="info" (click)="editReport(report)">
                            <nb-icon icon="edit-outline"></nb-icon>
                          </button>

                          <button nbButton status="warning" (click)="archiveReport(report)">
                            <nb-icon icon="archive-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div *ngIf="archivedReports.length">
                  <h4>Liste des Rapports Archivés</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Titre</th>
                        <th>Contenu</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let archivedReport of archivedReports">
                        <td>{{ archivedReport.title }}</td>
                        <td>{{ archivedReport.content }}</td>
                        <td>
                          <button nbButton status="danger" (click)="deleteReport(archivedReport)">
                            <nb-icon icon="trash-2-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </nb-tab>

              <!-- Feedback et Améliorations -->
              <nb-tab tabTitle="Feedback et Améliorations">
                <!-- Collecte des Feedbacks Utilisateurs -->
                <form (ngSubmit)="addFeedback()" #feedbackForm="ngForm" class="feedback-form">
                  <h4>Collecte des Feedbacks Utilisateurs</h4>
                  <div class="form-group">
                    <label for="feedbackContent">Feedback Utilisateur</label>
                    <textarea nbInput fullWidth id="feedbackContent" class="form-control"
                      [(ngModel)]="newFeedback.content" name="feedbackContent" required></textarea>
                  </div>
                  <button nbButton status="primary" type="submit" [disabled]="!feedbackForm.valid">
                    Ajouter Feedback
                  </button>
                </form>

                <!-- Liste des Feedbacks -->
                <div *ngIf="feedbacks.length">
                  <h4>Liste des Feedbacks</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Feedback</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let feedback of feedbacks">
                        <td>{{ feedback.content }}</td>
                        <td>
                          <button nbButton status="info" (click)="editFeedback(feedback)">
                            <nb-icon icon="edit-outline"></nb-icon>
                          </button>
                          <button nbButton status="warning" (click)="archiveFeedback(feedback)">
                            <nb-icon icon="archive-outline"></nb-icon>
                          </button>
                          <button nbButton status="danger" (click)="deleteFeedback(feedback)" [disabled]="!feedback.archived">
                            <nb-icon icon="trash-2-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Liste des Feedbacks Archivés -->
                <div *ngIf="archivedFeedbacks.length">
                  <h4>Liste des Feedbacks Archivés</h4>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Feedback</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let feedback of archivedFeedbacks">
                        <td>{{ feedback.content }}</td>
                        <td>
                          <button nbButton status="danger" (click)="deleteFeedback(feedback)">
                            <nb-icon icon="trash-2-outline"></nb-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </nb-tab>
            </nb-tabset>
          </nb-card-body>
        </nb-card>
      </nb-step>

    </nb-stepper>
  </nb-card-body>
</nb-card>
<ngx-dsdm-dash></ngx-dsdm-dash>
